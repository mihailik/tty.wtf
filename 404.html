<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TTY</title>
<style>
html {
  box-sizing: border-box;
  width: 100%; height: 100%;
  overflow: hidden;
  padding: 0; margin: 0;
}
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
  width: 100%; height: 100%;
  overflow: hidden;
  padding: 0; margin: 0;
}
*, *:before, *:after {
  box-sizing: inherit;
}

#toolbar {
  position: absolute;
  top: 0; left: 0; width: 100%;
  background-image: linear-gradient(to top, #fff6f6, white 1em);
  border-bottom: solid 1px #ffe6e6;
  padding-left: 0.3em;
}

#toolbar button {
  width: 2.7em; height: 2.7em; margin: 0.15em;
}

#textarea {
  position: absolute;
  top: 0; left: 0; width: 100%; height: 100%;
  overflow: auto;
  border: none;
  padding: 1em;
  outline: none;
  font: inherit;
  padding-top: 4em;
}

</style>
</head>
<body>
<textarea id="textarea" autofocus>
</textarea>
<div id="toolbar">
<button id="bold">ğ—•</button>
<button id="italic">ğ˜</button>
<button id="fractur">ğ•±</button>
<button id="cursive">ğ“’</button>
<button id="upper">áµ</button>
<button id="squareBox">ğŸ…‚</button>
<button id="squareFill">ğŸ†€</button>
<button id="round">â“‡</button>
<button id="typewrighter">ğšƒ</button>
<button id="wide">ğ•</button>

<div id="status" style="
  position: absolute;
  right: 1em;
  top: 0;"></div>
</div>
<script>
// @ts-check

function load() {

  var variants = {
    bold: {AZ: 'ğ—”ğ—•ğ—–ğ——ğ—˜ğ—™ğ—šğ—›ğ—œğ—ğ—ğ—Ÿğ— ğ—¡ğ—¢ğ—£ğ—¤ğ—¥ğ—¦ğ—§ğ—¨ğ—©ğ—ªğ—«ğ—¬ğ—­', az: 'ğ—®ğ—¯ğ˜‡ğ—±ğ—²ğ—³ğ—´ğ—µğ—¶ğ—·ğ—¸ğ—¹ğ—ºğ—»ğ—¼ğ—½ğ—¾ğ—¿ğ˜€ğ˜ğ˜‚ğ˜ƒğ˜„ğ˜…ğ˜†ğ˜‡', '09': 'ğŸ¬ğŸ­ğŸ®ğŸ¯ğŸ°ğŸ±ğŸ²ğŸ³ğŸ´ğŸµ'},
    italic: {AZ:'ğ˜ˆğ˜‰ğ˜Šğ˜‹ğ˜Œğ˜ğ˜ğ˜ğ˜ğ˜‘ğ˜’ğ˜“ğ˜”ğ˜•ğ˜–ğ˜—ğ˜˜ğ˜™ğ˜šğ˜›ğ˜œğ˜ğ˜ğ˜Ÿğ˜ ğ˜¡', az:'ğ˜¢ğ˜£ğ˜»ğ˜¥ğ˜¦ğ˜§ğ˜¨ğ˜©ğ˜ªğ˜«ğ˜¬ğ˜­ğ˜®ğ˜¯ğ˜°ğ˜±ğ˜²ğ˜³ğ˜´ğ˜µğ˜¶ğ˜·ğ˜¸ğ˜¹ğ˜ºğ˜»'},
    bolditalic: {AZ: 'ğ˜¼ğ˜½ğ˜¾ğ˜¿ğ™€ğ™ğ™‚ğ™ƒğ™„ğ™…ğ™†ğ™‡ğ™ˆğ™‰ğ™Šğ™‹ğ™Œğ™ğ™ğ™ğ™ğ™‘ğ™’ğ™“ğ™”ğ™•', az: 'ğ™–ğ™—ğ™¯ğ™™ğ™šğ™›ğ™œğ™ğ™ğ™Ÿğ™ ğ™¡ğ™¢ğ™£ğ™¤ğ™¥ğ™¦ğ™§ğ™¨ğ™©ğ™ªğ™«ğ™¬ğ™­ğ™®ğ™¯'},
    fractur: {AZ: 'ğ”„ğ”…â„­ğ”‡ğ”ˆğ”‰ğ”Šâ„Œâ„‘ğ”ğ”ğ”ğ”ğ”‘ğ”’ğ”“ğ””â„œğ”–ğ”—ğ”˜ğ”™ğ”šğ”›ğ”œâ„¨', az: 'ğ”ğ”Ÿğ”·ğ”¡ğ”¢ğ”£ğ”¤ğ”¥ğ”¦ğ”§ğ”¨ğ”©ğ”ªğ”«ğ”¬ğ”­ğ”®ğ”¯ğ”°ğ”±ğ”²ğ”³ğ”´ğ”µğ”¶ğ”·'},
    boldfractur: {AZ: 'ğ•¬ğ•­ğ•®ğ•¯ğ•°ğ•±ğ•²ğ•³ğ•´ğ•µğ•¶ğ•·ğ•¸ğ•¹ğ•ºğ•»ğ•¼ğ•½ğ•¾ğ•¿ğ–€ğ–ğ–‚ğ–ƒğ–„ğ–…', az:'ğ–†ğ–‡ğ–Ÿğ–‰ğ–Šğ–‹ğ–Œğ–ğ–ğ–ğ–ğ–‘ğ–’ğ–“ğ–”ğ–•ğ––ğ–—ğ–˜ğ–™ğ–šğ–›ğ–œğ–ğ–ğ–Ÿ'},
    cursive: {AZ:'ğ’œğµğ’ğ’Ÿğ¸ğ¹ğ’¢ğ»ğ¼ğ’¥ğ’¦ğ¿ğ‘€ğ’©ğ’ªğ’«ğ’¬ğ‘…ğ’®ğ’¯ğ’°ğ’±ğ’²ğ’³ğ’´ğ’µ', az: 'ğ’¶ğ’·ğ“ğ’¹ğ‘’ğ’»ğ‘”ğ’½ğ’¾ğ’¿ğ“€ğ“ğ“‚ğ“ƒğ‘œğ“…ğ“†ğ“‡ğ“ˆğ“‰ğ“Šğ“‹ğ“Œğ“ğ“ğ“'},
    boldcursive: {AZ:'ğ“ğ“‘ğ“’ğ““ğ“”ğ“•ğ“–ğ“—ğ“˜ğ“™ğ“šğ“›ğ“œğ“ğ“ğ“Ÿğ“ ğ“¡ğ“¢ğ“£ğ“¤ğ“¥ğ“¦ğ“§ğ“¨ğ“©', az: 'ğ“ªğ“«ğ”ƒğ“­ğ“®ğ“¯ğ“°ğ“±ğ“²ğ“³ğ“´ğ“µğ“¶ğ“·ğ“¸ğ“¹ğ“ºğ“»ğ“¼ğ“½ğ“¾ğ“¿ğ”€ğ”ğ”‚ğ”ƒ'},
    upper: {AP: 'á´¬á´®á¶œá´°á´±á¶ á´³á´´á´µá´¶á´·á´¸á´¹á´ºá´¼á´¾', RZ: 'á´¿Ë¢áµ€áµâ±½áµ‚Ë£Ê¸á¶»', ap: 'áµƒáµ‡á¶»áµˆáµ‰á¶ áµÊ°â±Ê²áµË¡áµâ¿áµ’áµ–', rz: 'Ê³Ë¢áµ—áµ˜áµ›Ê·Ë£Ê¸á¶»', '09': 'â°Â¹Â²Â³â´âµâ¶â·â¸â¹'},
    squareBox: {AZ: 'ğŸ„°ğŸ„±ğŸ„²ğŸ„³ğŸ„´ğŸ„µğŸ„¶ğŸ„·ğŸ„¸ğŸ„¹ğŸ„ºğŸ„»ğŸ„¼ğŸ„½ğŸ„¾ğŸ„¿ğŸ…€ğŸ…ğŸ…‚ğŸ…ƒğŸ…„ğŸ……ğŸ…†ğŸ…‡ğŸ…ˆğŸ…‰'},
    squareFill: {AP: 'ğŸ…°ğŸ…±ğŸ…²ğŸ…³ğŸ…´ğŸ…µğŸ…¶ğŸ…·ğŸ…¸ğŸ…¹ğŸ…ºğŸ…»ğŸ…¼ğŸ…½ğŸ…¾ğŸ…¿ğŸ†€ğŸ†ğŸ†‚ğŸ†ƒğŸ†„ğŸ†…ğŸ††ğŸ†‡ğŸ†ˆğŸ†‰'},
    round: {AZ:'â’¶â’·â’¸â’¹â’ºâ’»â’¼â’½â’¾â’¿â“€â“â“‚â“ƒâ“„â“…â“†â“‡â“ˆâ“‰â“Šâ“‹â“Œâ“â“â“', az: 'â“â“‘â“©â““â“”â“•â“–â“—â“˜â“™â“šâ“›â“œâ“â“â“Ÿâ“ â“¡â“¢â“£â“¤â“¥â“¦â“§â“¨â“©', '09': 'â“ªâ‘ â‘¡â‘¢â‘£â‘¤â‘¥â‘¦â‘§â‘¨'},
    typewriter: {AZ:'ğ™°ğ™±ğ™²ğ™³ğ™´ğ™µğ™¶ğ™·ğ™¸ğ™¹ğ™ºğ™»ğ™¼ğ™½ğ™¾ğ™¿ğš€ğšğš‚ğšƒğš„ğš…ğš†ğš‡ğšˆğš‰', az: 'ğšŠğš‹ğš£ğšğšğšğšğš‘ğš’ğš“ğš”ğš•ğš–ğš—ğš˜ğš™ğššğš›ğšœğšğšğšŸğš ğš¡ğš¢ğš£', '09': 'ğŸ¶ğŸ·ğŸ¸ğŸ¹ğŸºğŸ»ğŸ¼ğŸ½ğŸ¾ğŸ¿'},
    wide: {AZ: 'ğ”¸ğ”¹â„‚ğ”»ğ”¼ğ”½ğ”¾â„ğ•€ğ•ğ•‚ğ•ƒğ•„â„•ğ•†â„™â„šâ„ğ•Šğ•‹ğ•Œğ•ğ•ğ•ğ•â„¤', az: 'ğ•’ğ•“ğ•«ğ••ğ•–ğ•—ğ•˜ğ•™ğ•šğ•›ğ•œğ•ğ•ğ•Ÿğ• ğ•¡ğ•¢ğ•£ğ•¤ğ•¥ğ•¦ğ•§ğ•¨ğ•©ğ•ªğ•«', '09': 'ğŸ˜ğŸ™ğŸšğŸ›ğŸœğŸğŸğŸŸğŸ ğŸ¡'}
  };

  var save_timeout;
  var selection_timeout;
  
  var textarea = /** @type {HTMLTextAreaElement} */(document.getElementById('textarea'));
  textarea.value = getStorageText();

  var status = document.getElementById('status');

  textarea.onchange = textarea_onchange;
  textarea.onselect = textarea_onselectionchange;
  textarea.onselectionchange = textarea_onselectionchange;
  textarea.onselectstart = textarea_onselectionchange;
  textarea.onkeydown = textarea_onselectionchange;
  textarea.onkeyup = textarea_onselectionchange;
  textarea.onmousedown = textarea_onselectionchange;

  window.onunload = window_onunload;

  addButtonHandlers();
  textarea_onselectionchange();

  function addButtonHandlers() {
    var buttonsArray = document.getElementsByTagName('button');
    for (var i = 0; i < buttonsArray.length; i++) {
      addHandler(buttonsArray[i]);
    }

    function addHandler(btn) {
      btn.onmousedown = btn_onmousedown;
      btn.onmouseup = btn_mouseup;
      btn.onclick = btn_click;

      function btn_onmousedown(evt) {
        if (evt.preventDefault) evt.preventDefault();
        // TODO: apply 
      }

      function btn_mouseup(evt) {
        if (evt.preventDefault) evt.preventDefault();
      }

      function btn_click(evt) {
        if (evt.preventDefault) evt.preventDefault();
      }
    }
  }

  function getStorageText() {
    try {
      return localStorage.getItem('tty.wtf.content');
    } catch (error) {
      console.log('Browser failed to get data from localStorage. ', error);
    }
  }

  function setStorageText(text) {
    try {
      localStorage.setItem('tty.wtf.content', text);
      setStorageText.lastStorageSuccess = true;
    } catch (error) {
      if (setStorageText.lastStorageSuccess !== true)
        console.log('Browser failed to store data into localStorage. ', error);
      setStorageText.lastStorageSuccess = false;
    }
  }

  function textarea_onchange() {
    clearTimeout(save_timeout);
    save_timeout = setTimeout(textarea_onchange_debounced, 600);
  }

  function textarea_onchange_debounced() {
    setStorageText(textarea.value);
    textarea_onselectionchange_debounced();
  }

  function textarea_onselectionchange() {
    clearTimeout(selection_timeout);
    selection_timeout = setTimeout(textarea_onselectionchange_debounced, 100);
  }

  function textarea_onselectionchange_debounced() {
    // TODO: detect selection and update font toolbar
    status.textContent = status.innerText = textarea.selectionStart + ':' + (textarea.selectionEnd - textarea.selectionStart);
  }

  function window_onunload() {
    // save to local storage NOW
    textarea_onchange_debounced();
  }

  /** @param str {string} */
  function getModifiers(str) {
    var char = str.charAt(0);
    var result = [];
    for (var modKind in variants) {
      var rangeMap = variants[modKind];
      if (!rangeMap || typeof rangeMap !== 'object') continue;

      for (var rangeDescr in rangeMap) {
        var rangeList = rangeMap[rangeDescr];
        if (typeof rangeList !== 'string') continue;
        if (rangeList.indexOf(char)>=0) {
          // TODO: add modKind, but pay attention to bold overlap
        }
      }
    }

    return result;
  }

  /** @param str {string} */
  function breakIntoChars(str) {
    /** @type {string[]} */
    var arr = [];
    str.replace(/./ug, function (ch) {
      arr.push(ch);
      return '';
    });
    return arr;
  }
}
window.onload = load;
</script>
</body>
</html>